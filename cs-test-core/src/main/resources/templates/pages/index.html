<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Bootstrap 101 Template</title>

    <script th:src="@{/webjars/vue/dist/vue.min.js}"></script>
    <!-- Bootstrap -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">

    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div id="app">

    <div class="panel panel-default" v-for="obj in list">
        <!-- Default panel contents -->
        <div class="panel-heading">{{obj.name}}</div>
        <div class="panel-body">
            <p>{{obj.desc}}</p>
        </div>

        <!-- List group -->
        <ul class="list-group" v-for="item in obj.methodDescribeList" style="margin: 10px">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <button style="margin-bottom: 10px" type="button" class="list-group-item"  @click="executeFunc(item,$event)">{{item.desc}}</button>

                    <div class="input-group" v-for="n in item.names.length">
                        <span class="input-group-addon">@</span>
                        <input type="text" v-bind:name="item.names[n-1]" class="form-control" v-bind:placeholder="entity.fieldName" aria-describedby="basic-addon1" v-if="item.types[n-1]=='String'">
                        <input type="text" v-bind:name="item.names[n-1]" class="form-control" v-bind:placeholder="entity.fieldName" aria-describedby="basic-addon1" v-if="item.types[n-1]=='Integer'">
                        <input type="text" v-bind:name="item.names[n-1]" class="form-control" v-bind:placeholder="entity.fieldName" aria-describedby="basic-addon1" v-if="item.types[n-1]=='Double'">
                        <input type="date" v-bind:name="item.names[n-1]" class="form-control" v-bind:placeholder="entity.fieldName" aria-describedby="basic-addon1" v-if="item.types[n-1]=='Date'">
                    </div>

                    <div v-for="entityMap in item.entityMap">
                        <div class="panel panel-default">
                            <div class="panel-body result">
                                <div class="input-group" v-for="entity in entityMap">
                                    <span class="input-group-addon">@</span>
                                    <input type="text" v-bind:name="entity.fieldName" class="form-control" v-bind:placeholder="entity.fieldName" aria-describedby="basic-addon1" v-if="entity.fieldType=='String'">
                                    <input type="text" v-bind:name="entity.fieldName" class="form-control" v-bind:placeholder="entity.fieldName" aria-describedby="basic-addon1" v-if="entity.fieldType=='Integer'">
                                    <input type="text" v-bind:name="entity.fieldName" class="form-control" v-bind:placeholder="entity.fieldName" aria-describedby="basic-addon1" v-if="entity.fieldType=='Double'">
                                    <input type="date" v-bind:name="entity.fieldName" class="form-control" v-bind:placeholder="entity.fieldName" aria-describedby="basic-addon1" v-if="entity.fieldType=='Date'">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="panel-body result">
                    <p></p>
                </div>
            </div>
            <!--<button type="button" class="list-group-item">{{item.desc}}</button>-->
            <!--<li class="list-group-item">{{item.desc}}</li>-->
        </ul>
    </div>
</div>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
<script>
    var vm = null;
    $(function () {
        vm = new Vue({
            el:"#app",
            data:{
                list:[
                    {
                        "name":"",
                        "desc":"",
                        "methodDescribeList":[
                            {"name":"","desc":"","names":[],"types":[]}
                        ]
                    }
                ]
            },
            mounted:function () {
                $.post("/test/methodList",{},function (data,status,xhr) {
                    vm.list = data;
                })
            },
            methods:{
                executeFunc:function (method,event) {
                    var params = {};
//                    params.methodName = method.name;
                    $(event.target).parent().find(".input-group :input").each(function (index,obj) {
                        params[obj.name] = obj.value;
                    })
                    $.ajax({
                        url:"/test/test?methodName="+method.name,
                        data:params,
                        type:"POST",
                        context:this,
                        success:function (result,status,xhr) {
                            var target = event.target;
                            var $target = $(target);
                            $target.parent().parent().find(".result p").html(result);
                        },
                        error:function (xhr,status,error) {
                            console.log(error)
                        },
                    })
                }
            }
        })
    })
</script>
</body>
</html>